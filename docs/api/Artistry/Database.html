<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Crystal Docs 1.19.1">
<meta name="crystal_docs.project_version" content="0.9.0-dev">
<meta name="crystal_docs.project_name" content="artistry">



<link href="../css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../js/doc.js"></script>

  <meta name="repository-name" content="artistry">
  <title>Artistry::Database - artistry 0.9.0-dev</title>
  <script type="text/javascript">
    CrystalDocs.base_path = "../";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill="currentColor" fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<input type="checkbox" id="sidebar-btn">
<label for="sidebar-btn" id="sidebar-btn-label">
  <svg class="open" xmlns="http://www.w3.org/2000/svg" height="2em" width="2em" viewBox="0 0 512 512"><title>Open Sidebar</title><path fill="currentColor" d="M80 96v64h352V96H80zm0 112v64h352v-64H80zm0 112v64h352v-64H80z"></path></svg>
  <svg class="close" xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 512 512"><title>Close Sidebar</title><path fill="currentColor" d="m118.6 73.4-45.2 45.2L210.7 256 73.4 393.4l45.2 45.2L256 301.3l137.4 137.3 45.2-45.2L301.3 256l137.3-137.4-45.2-45.2L256 210.7Z"></path></svg>
</label>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="../index.html">
          artistry
        </a>
      </h1>

      <span class="project-version">
        0.9.0-dev
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent open current" data-id="artistry/Artistry" data-name="artistry">
      <a href="../Artistry.html">Artistry</a>
      
        <ul>
  
  <li class=" " data-id="artistry/Artistry/Artifact" data-name="artistry::artifact">
      <a href="../Artistry/Artifact.html">Artifact</a>
      
    </li>
  
  <li class=" current" data-id="artistry/Artistry/Database" data-name="artistry::database">
      <a href="../Artistry/Database.html">Database</a>
      
    </li>
  
  <li class=" " data-id="artistry/Artistry/Link" data-name="artistry::link">
      <a href="../Artistry/Link.html">Link</a>
      
    </li>
  
  <li class=" " data-id="artistry/Artistry/Registry" data-name="artistry::registry">
      <a href="../Artistry/Registry.html">Registry</a>
      
    </li>
  
  <li class=" " data-id="artistry/Artistry/Tag" data-name="artistry::tag">
      <a href="../Artistry/Tag.html">Tag</a>
      
    </li>
  
  <li class=" " data-id="artistry/Artistry/Transaction" data-name="artistry::transaction">
      <a href="../Artistry/Transaction.html">Transaction</a>
      
    </li>
  
  <li class="parent " data-id="artistry/Artistry/ValidationError" data-name="artistry::validationerror">
      <a href="../Artistry/ValidationError.html">ValidationError</a>
      
        <ul>
  
  <li class=" " data-id="artistry/Artistry/ValidationError/FieldError" data-name="artistry::validationerror::fielderror">
      <a href="../Artistry/ValidationError/FieldError.html">FieldError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="artistry/Artistry/Validator" data-name="artistry::validator">
      <a href="../Artistry/Validator.html">Validator</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1 class="type-name">

  <span class="kind">
    module
  </span> Artistry::<wbr>Database

</h1>




















  <h2>
    <a id="defined-in" class="anchor" href="#defined-in">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Defined in:
  </h2>
  
    
      artistry/database.cr
    
    <br/>
  



  
    <h2>
      <a id="constant-summary" class="anchor" href="#constant-summary">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
      Constant Summary
    </h2>
  
  <dl>
    
      <dt class="entry-const" id="SCHEMA">
        <strong>SCHEMA</strong> = <code><span class="s">&quot;  CREATE TABLE IF NOT EXISTS identity (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    created_at INTEGER NOT NULL DEFAULT (cast((julianday(&#39;now&#39;) - 2440587.5) * 86400000 as integer))\n  );\n\n  CREATE TABLE IF NOT EXISTS registry (\n    code TEXT PRIMARY KEY,\n    kind TEXT NOT NULL,\n    plugin TEXT NOT NULL,\n    description TEXT,\n    symbol TEXT,\n    version INTEGER NOT NULL DEFAULT 1,\n    UNIQUE(plugin, kind)\n  );\n\n  CREATE TABLE IF NOT EXISTS schema (\n    code TEXT NOT NULL,\n    version INTEGER NOT NULL,\n    json TEXT NOT NULL,\n    hash TEXT NOT NULL,\n    created_at INTEGER NOT NULL DEFAULT (cast((julianday(&#39;now&#39;) - 2440587.5) * 86400000 as integer)),\n    PRIMARY KEY (code, version),\n    FOREIGN KEY (code) REFERENCES registry(code)\n  );\n\n  CREATE TABLE IF NOT EXISTS artifact (\n    id INTEGER PRIMARY KEY,\n    code TEXT NOT NULL,\n    version INTEGER NOT NULL,\n    data JSON NOT NULL,\n    hash TEXT NOT NULL,\n    new_id INTEGER REFERENCES identity(id),\n    updated_at INTEGER,\n    FOREIGN KEY (id) REFERENCES identity(id),\n    FOREIGN KEY (code, version) REFERENCES schema(code, version)\n  );\n\n  CREATE INDEX IF NOT EXISTS idx_artifact_code ON artifact(code);\n  CREATE INDEX IF NOT EXISTS idx_artifact_new_id ON artifact(new_id);\n\n  CREATE TABLE IF NOT EXISTS link (\n    from_id INTEGER NOT NULL REFERENCES identity(id) ON DELETE CASCADE,\n    to_id INTEGER NOT NULL REFERENCES identity(id) ON DELETE CASCADE,\n    rel TEXT NOT NULL,\n    data JSON,\n    created_at INTEGER NOT NULL DEFAULT (cast((julianday(&#39;now&#39;) - 2440587.5) * 86400000 as integer)),\n    PRIMARY KEY (from_id, to_id, rel)\n  );\n\n  CREATE TABLE IF NOT EXISTS tag (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    name TEXT NOT NULL UNIQUE,\n    created_at INTEGER NOT NULL DEFAULT (cast((julianday(&#39;now&#39;) - 2440587.5) * 86400000 as integer))\n  );\n\n  CREATE TABLE IF NOT EXISTS tagging (\n    tag_id INTEGER NOT NULL REFERENCES tag(id) ON DELETE CASCADE,\n    artifact_id INTEGER NOT NULL REFERENCES identity(id) ON DELETE CASCADE,\n    created_at INTEGER NOT NULL DEFAULT (cast((julianday(&#39;now&#39;) - 2440587.5) * 86400000 as integer)),\n    PRIMARY KEY (tag_id, artifact_id)\n  );\n\n  CREATE INDEX IF NOT EXISTS idx_tagging_artifact_id ON tagging(artifact_id);&quot;</span></code>
      </dt>
      
    
  </dl>



  

  
  <h2>
    <a id="class-method-summary" class="anchor" href="#class-method-summary">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Class Method Summary
  </h2>
  <ul class="list-summary">
    
      <li class="entry-summary">
        <a href="#ensure_schema%28db%3ADB%3A%3ADatabase%29%3ANil-class-method" class="signature"><strong>.ensure_schema</strong>(db : DB::Database) : Nil</a>
        
      </li>
    
  </ul>


  

  


  <div class="methods-inherited">
    
  </div>

  

  
  <h2>
    <a id="class-method-detail" class="anchor" href="#class-method-detail">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>
    Class Method Detail
  </h2>
  
    <div class="entry-detail" id="ensure_schema(db:DB::Database):Nil-class-method">
      <div class="signature">
        
        def self.<strong>ensure_schema</strong>(db : DB::Database) : Nil

        <a class="method-permalink" href="#ensure_schema%28db%3ADB%3A%3ADatabase%29%3ANil-class-method">#</a>
      </div>
      
      <br/>
      <div>
        
      </div>
    </div>
  


  

  


</div>

</body>
</html>
